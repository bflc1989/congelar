<%- include('./cabecalho'); %>
<h1 class="main">Pagina Principal</h1>
<div class="container-fluid">
  <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="PJ-tab" data-bs-toggle="tab" data-bs-target="#PJ-tab-pane" type="button" role="tab" aria-controls="PJ-tab-pane" aria-selected="true">Clientes PJ</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="PF-tab" data-bs-toggle="tab" data-bs-target="#PF-tab-pane" type="button" role="tab" aria-controls="PF-tab-pane" aria-selected="false">Clientes PF</button>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="PJ-tab-pane" role="tabpanel" aria-labelledby="PJ-tab" tabindex="0">
      <div class="table-responsive m-3">
        <table id="tablepj" class="table table-striped m-6">
          <thead>
            <th>CNPJ</th>
            <th>Empresa</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Status</th>
            <th>Data Ultimo Serviço</th>
          </thead>
          <tbody>
            <% if(resultados.length > 0) { %> <% for(var j = 0; j < resultados.length; j++) {%>
            <tr>
              <td><%=resultados[j].idclientepj %></td>
              <td><%=resultados[j].empresa %></td>
              <td><%=resultados[j].telefone %></td>
              <td><%=resultados[j].email %></td>
              <td><%=resultados[j].status %></td>
              <td><%=resultados[j].niceDate %></td>
            </tr>
            <% } %> <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="tab-pane fade show" id="PF-tab-pane" role="tabpanel" aria-labelledby="PF-tab" tabindex="0">
      <div class="table-responsive m-3">
        <table id="tablepf" class="table table-striped m-6">
          <thead>
            <th>CPF</th>
            <th>Nome</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Status</th>
            <th>Data Ultimo Serviço</th>
          </thead>
          <tbody>
            <% if(resultado.length > 0) { %> <% for(var j = 0; j < resultado.length; j++) {%>
            <tr>
              <td><%=resultado[j].idclientepf %></td>
              <td><%=resultado[j].nome %></td>
              <td><%=resultado[j].telefone %></td>
              <td><%=resultado[j].email %></td>
              <td><%=resultado[j].status %></td>
              <td><%=resultado[j].niceDate %></td>
            </tr>
            <% } %> <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pnotify/3.0.0/pnotify.min.js"></script>
<script src="https://colorlib.com/polygon/vendors/jquery/dist/jquery.min.js"></script>
<script src="https://colorlib.com/polygon/vendors/pnotify/dist/pnotify.js"></script>
<script src="https://colorlib.com/polygon/vendors/pnotify/dist/pnotify.buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
<script>
  setInterval(function () {
    init_PNotifypj();
    init_PNotifypf();
  }, 15000);

  function init_PNotifypj() {
    $("#tablepj tbody tr").each(function (i) {
      tr = $(this);

      var nome = tr.children("td:eq(0)").html();
      notificaçãopj(nome);
    });
  }
  function init_PNotifypf() {
    $("#tablepf tbody tr").each(function (i) {
      tr = $(this);

      var nome = tr.children("td:eq(0)").html();
      notificaçãopf(nome);
    });
  }

  function notificaçãopj(nome) {
    new PNotify({
      title: "Alerta",
      type: "info",
      text: "Empresa " + nome + " com manutençao vencida",
      maxonscreen: Infinity,
      closer: true,
      closer_hover: true,
      opacity: 0.95,
      history: false,
      sticker: true,
      width: "360px",
      nonblock: {
        nonblock: true,
      },
      addclass: "pnotify-center",
      delay: 2000,
      styling: "bootstrap3",
      hide: true,
      remove: true,
    });
  }

  function notificaçãopf(nome) {
    new PNotify({
      title: "Alerta",
      type: "info",
      text: "Cliente " + nome + " com manutençao vencida",
      maxonscreen: Infinity,
      closer: true,
      closer_hover: true,
      opacity: 0.95,
      history: false,
      sticker: true,
      width: "360px",
      nonblock: {
        nonblock: true,
      },
      addclass: "pnotify-center",
      delay: 2000,
      styling: "bootstrap3",
      hide: true,
      remove: true,
    });
  }
</script>
